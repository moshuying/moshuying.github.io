<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><script>var _paq = window._paq = window._paq || [];
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);  
var u="//matomo.analysis.msy.plus/";
_paq.push(['setTrackerUrl', u+'matomo.php']);
_paq.push(['setSiteId', '1']);
var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);</script><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="theme-color" content="#54bcff"><link rel="manifest" href="/manifest.json?v=2.6.2"><link rel="icon" href="/uploads/pic-300x256.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/uploads/pic-512x512.jpg?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros       å› ä¸ºä¸å¤ªæ˜ç™½nginxçš„é…ç½®æ–‡ä»¶ï¼Œåƒäº†ç‚¹äºï¼Œå®é™…ä¸Šæ“ä½œèµ·æ¥éå¸¸ç®€å•">
<meta property="og:type" content="article">
<meta property="og:title" content="å®å¡” nginx cros">
<meta property="og:url" content="https://msy.plus/2019/02/07/nginx-cros/index.html">
<meta property="og:site_name" content="å¢¨æŠ’é¢–">
<meta property="og:description" content="è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros       å› ä¸ºä¸å¤ªæ˜ç™½nginxçš„é…ç½®æ–‡ä»¶ï¼Œåƒäº†ç‚¹äºï¼Œå®é™…ä¸Šæ“ä½œèµ·æ¥éå¸¸ç®€å•">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-02-07T09:43:25.000Z">
<meta property="article:modified_time" content="2021-06-18T12:00:40.758Z">
<meta property="article:author" content="å¢¨æŠ’é¢–">
<meta property="article:tag" content="è¿ç»´">
<meta property="article:tag" content="nginx">
<meta property="article:tag" content="cros">
<meta property="article:tag" content="å®å¡”">
<meta name="twitter:card" content="summary"><title>å®å¡” nginx cros | å¢¨æŠ’é¢–</title><link ref="canonical" href="https://msy.plus/2019/02/07/nginx-cros/"><link rel="alternate" href="/atom.xml" type="application/atom+xml"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: true,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: {"avoidBanner":true},
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"å¤åˆ¶","copySuccess":"å¤åˆ¶æˆåŠŸ","copyError":"å¤åˆ¶å¤±è´¥"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">é¦–é¡µ</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">å½’æ¡£</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">åˆ†ç±»</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">æ ‡ç­¾</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/friendsAccounts/"><span class="header-nav-menu-item__icon"><i class="fas fa-torah"></i></span><span class="header-nav-menu-item__text">å‹é“¾</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/discover/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">å‘ç°</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">æœç´¢</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">å¢¨æŠ’é¢–</div><div class="header-banner-info__subtitle">å¤§å¤šæ•°äººéƒ½é«˜ä¼°äº†ä»–ä»¬ä¸€å¤©èƒ½åšçš„äº‹æƒ…ï¼Œä½†ä½ä¼°äº†ä»–ä»¬ä¸€å¹´èƒ½åšçš„äº‹æƒ…</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">å®å¡” nginx cros</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2019-02-07</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-06-18</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">å­—æ•°ç»Ÿè®¡</span><span class="post-meta-item__value">5.1k</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">é˜…è¯»æ¬¡æ•°</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h1 id="è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros"   >
          <a href="#è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros" class="heading-link"><i class="fas fa-link"></i></a><a href="#è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros" class="headerlink" title="è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros"></a>è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros</h1>
      <p>å› ä¸ºä¸å¤ªæ˜ç™½nginxçš„é…ç½®æ–‡ä»¶ï¼Œåƒäº†ç‚¹äºï¼Œå®é™…ä¸Šæ“ä½œèµ·æ¥éå¸¸ç®€å•</p>
<span id="more"></span>

        <h2 id="2020å¹´12æœˆ12æ—¥11-59-56-æ›´æ–°"   >
          <a href="#2020å¹´12æœˆ12æ—¥11-59-56-æ›´æ–°" class="heading-link"><i class="fas fa-link"></i></a><a href="#2020å¹´12æœˆ12æ—¥11-59-56-æ›´æ–°" class="headerlink" title="2020å¹´12æœˆ12æ—¥11:59:56 æ›´æ–°"></a>2020å¹´12æœˆ12æ—¥11:59:56 æ›´æ–°</h2>
      <p>è¿‘æœŸå› ä¸ºé¡¹ç›®éœ€è¦å†ä¸€æ¬¡é…ç½®äº†nginx è¿™æ¬¡çš„çš„éœ€æ±‚è®¾è®¡åˆ°å­—ç¬¦ä¸²å¤„ç† éœ€è¦æŠŠ<code>&lt;åŸŸåæˆ–ip&gt;/xhr_api/</code>å¼€å¤´çš„è¯·æ±‚è½¬å‘åˆ°å†…ç½‘æŸæœºå™¨ï¼ŒåŒæ—¶ç§»é™¤æ‰xhr_apiï¼Œè¿™é‡Œç›´æ¥è®°å½•ä¸‹ç»“æœï¼Œé…ç½®éå¸¸ç®€å•</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location ~ ^/(xhr\_api/)(.*)$ &#123;</span><br><span class="line">    # return 200 &quot;$1,$2,$3&quot;; #$2æ˜¯è¢«æ‹¬å·åŒ…èµ·æ¥çš„å†…å®¹</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header Host  $http_host;</span><br><span class="line">    proxy_set_header X-Nginx-Proxy true;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Connection &quot;&quot;;</span><br><span class="line">    </span><br><span class="line">    # ä¸éœ€è¦è€ƒè™‘åˆ°è´Ÿè½½çš„ï¼Œå°±æ— éœ€é…ç½®upstreamèŠ‚ç‚¹ã€‚</span><br><span class="line">    proxy_pass http://127.0.0.1:5678/$2;# è¿™é‡Œ$2å‰é¢çš„/æ˜¯å› ä¸º`^/(xhr\_api/)(.*)$`æ­£åˆ™å·²ç»åŒ¹é…äº†`/` æ‰€ä»¥å–ä¸åˆ°`/`åœ¨è¿™é‡Œè¡¥ä¸Šäº†</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="2020å¹´10æœˆ09æ—¥11-34-æ›´æ–°"   >
          <a href="#2020å¹´10æœˆ09æ—¥11-34-æ›´æ–°" class="heading-link"><i class="fas fa-link"></i></a><a href="#2020å¹´10æœˆ09æ—¥11-34-æ›´æ–°" class="headerlink" title="2020å¹´10æœˆ09æ—¥11:34    æ›´æ–°"></a>2020å¹´10æœˆ09æ—¥11:34    æ›´æ–°</h2>
      <p>æœ€è¿‘åˆæ›´æ”¹äº†ä¸€ä¸‹nginxé…ç½®ï¼Œè¿™æ¬¡æ˜¯è°ƒæ•´nginxä»£ç†ç”¨ä»£ç†æœ¬æœºå…¶ä»–ç«¯å£çš„è¯·æ±‚ï¼Œå› ä¸ºä¸€æ¥æƒ³ç”¨nginxé…ç½®å„ç§è¯·æ±‚å¤„ç†ï¼Œhttpsä¹‹ç±»çš„ã€‚æ­£å¥½nginxå¯ä»¥å¾ˆå®¹æ˜“çš„åšåä»£ï¼Œåé¢è¿˜å¯ä»¥ç”¨nginxåšè´Ÿè½½å‡è¡¡ã€‚æ‰€ä»¥æ”¹æ”¹é…ç½®ä»€ä¹ˆçš„ã€‚æœ€å¥½ä¸è¿‡äº†ã€‚</p>
<p>æœ€ç»ˆæˆå“å¦‚ä¸‹ã€‚è¿™æ®µé…ç½®çš„æ„æ€æ˜¯åŒ¹é…æ‰€æœ‰ä»¥<code>&lt;åŸŸåæˆ–ip&gt;/node_api/</code>å¼€å¤´çš„è¯·æ±‚ç„¶åè½¬å‘åˆ°æœ¬æœºçš„ç«¯å£ã€‚è¿™é‡Œçš„ç«¯å£è®°å¾—æ”¹æˆä½ è‡ªå·±çš„ã€‚</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">location ~ ^/(node\_api/).* &#123;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header Host  $http_host;</span><br><span class="line">    proxy_set_header X-Nginx-Proxy true;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Connection &quot;&quot;;</span><br><span class="line">    </span><br><span class="line">    # ä¸éœ€è¦è€ƒè™‘åˆ°è´Ÿè½½çš„ï¼Œå°±æ— éœ€é…ç½®upstreamèŠ‚ç‚¹ã€‚</span><br><span class="line">    proxy_pass http://127.0.0.1:&lt;ä½ çš„ç«¯å£&gt;;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>å¦‚æœæœ‰å®å¡”é¢æ¿æœ‰é…ç½®é˜²ç›—é“¾è®°å¾—æŠŠé˜²ç›—é“¾å…³äº†ï¼Œåœ¨é¢æ¿å…³é—­æˆ–è€…æ‰‹åŠ¨ä»é…ç½®æ–‡ä»¶åˆ é™¤å¯¹åº”ä»£ç ã€‚</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># å®å¡”é¢æ¿çš„é˜²ç›—é“¾é…ç½®</span><br><span class="line">#SECURITY-START é˜²ç›—é“¾é…ç½®</span><br><span class="line">location ~ .*\.(jpg|jpeg|gif|png|js|css)$</span><br><span class="line">&#123;</span><br><span class="line">  expires      30d;</span><br><span class="line">  access_log /dev/null;</span><br><span class="line">  valid_referers none blocked &lt;ä½ çš„åŸŸå&gt;;</span><br><span class="line">  if ($invalid_referer)&#123;</span><br><span class="line">    return 404;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">#SECURITY-END</span><br></pre></td></tr></table></div></figure>

<p>ä¸Šé¢çš„ä»£ç ä¸­<code>location ~ .*\.(jpg|jpeg|gif|png|js|css)$</code>å°±æ˜¯æŒ‡åŒ¹é…è¯·æ±‚ä¸­åŒ…å«è¿™äº›åç¼€åçš„æ–‡ä»¶ï¼Œåªè¦è¯·æ±‚å¤´ä¸­çš„refererä¸åŒ…å«<code>valid_referers none blocked &lt;ä½ çš„åŸŸå&gt;;</code>ä¸­çš„<code>&lt;ä½ çš„åŸŸå&gt;</code>éƒ¨åˆ†ï¼Œå°±è¿”å›404ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦å¼€å¯å¯¹è¿™äº›æ–‡ä»¶çš„crosï¼Œè¿™éƒ¨åˆ†ä»£ç å°±æ˜¯å¿…é¡»è¦åˆ æ‰çš„ã€‚</p>
<p>å»æ‰è¿™éƒ¨åˆ†ä»£ç åçš„é…ç½®å°±ç®€å•äº†ã€‚æˆ‘è¿™æ¬¡åªå¯¹three.jsæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰åŒ…å«.css .jsåç¼€åçš„æ–‡ä»¶è¿›è¡Œè·¨åŸŸï¼Œæ‰€ä»¥åªéœ€è¦å¦‚ä¸‹è®¾ç½®ï¼Œ<code>expires      360d;</code>è¡¨ç¤ºè¿‡æœŸæ—¶é—´360å¤©ï¼ŒğŸ¤£</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location ~ .*\/three\.js.*\.(js|css)$</span><br><span class="line">&#123;</span><br><span class="line">  add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">  add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">  add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">  expires      360d;</span><br><span class="line">  error_log off;</span><br><span class="line">  access_log /dev/null; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>ä¹Ÿå¯ä»¥å‚è€ƒé˜²ç›—é“¾é…ç½®çš„è¿›è¡Œé’ˆå¯¹æŸäº›åŸŸåçš„ä¿®æ”¹</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#SECURITY-START é˜²ç›—é“¾é…ç½®</span><br><span class="line">location ~ .*\.(jpg|jpeg|gif|png|js|css)$</span><br><span class="line">&#123;</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">    expires      30d;</span><br><span class="line">    access_log /dev/null;</span><br><span class="line">    valid_referers none blocked *.moshuying.top,http://127.0.0.1:5500/;</span><br><span class="line">    if ($invalid_referer)&#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#SECURITY-END</span><br></pre></td></tr></table></div></figure>

<p>æœ‰æ—¶å€™é…ç½®ç”Ÿæ•ˆéœ€è¦ä¸€ç‚¹æ—¶é—´ï¼Œé…ç½®å®Œåˆ«å¤ªç€æ€¥</p>

        <h1 id="æ‰©å±•çŸ¥è¯†"   >
          <a href="#æ‰©å±•çŸ¥è¯†" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ‰©å±•çŸ¥è¯†" class="headerlink" title="æ‰©å±•çŸ¥è¯†"></a>æ‰©å±•çŸ¥è¯†</h1>
      <p>åä»£è¯·æ±‚åˆ°æœ¬æœº3000ç«¯å£</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &lt;åŒ¹é…é“¾æ¥&gt; &#123;</span><br><span class="line">  proxy_pass http://localhost:3000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Nginx é…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€serverï¼ˆä¸»æœºè®¾ç½®ï¼‰ã€upstreamï¼ˆä¸Šæ¸¸æœåŠ¡å™¨è®¾ç½®ï¼Œä¸»è¦ä¸ºåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç›¸å…³é…ç½®ï¼‰å’Œ locationï¼ˆURLåŒ¹é…ç‰¹å®šä½ç½®åçš„è®¾ç½®ï¼‰ã€‚main éƒ¨åˆ†è®¾ç½®çš„æŒ‡ä»¤å½±å“å…¶ä»–æ‰€æœ‰éƒ¨åˆ†çš„è®¾ç½®ï¼›server éƒ¨åˆ†çš„æŒ‡ä»¤ä¸»è¦ç”¨äºåˆ¶å®šè™šæ‹Ÿä¸»æœºåŸŸåã€IP å’Œç«¯å£å·ï¼›upstream çš„æŒ‡ä»¤ç”¨äºè®¾ç½®ä¸€ç³»åˆ—çš„åç«¯æœåŠ¡å™¨ï¼Œè®¾ç½®åå‘ä»£ç†åŠåç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼›location éƒ¨åˆ†ç”¨äºåŒ¹é…ç½‘é¡µä½ç½®ï¼ˆæ¯”å¦‚ï¼Œæ ¹ç›®å½•â€œ/â€ï¼Œâ€œ/imagesâ€ï¼Œç­‰ç­‰ï¼‰ã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼šserver ç»§æ‰¿ mainï¼Œlocation ç»§æ‰¿ serverï¼›upstream æ—¢ä¸ä¼šç»§æ‰¿æŒ‡ä»¤ä¹Ÿä¸ä¼šè¢«ç»§æ‰¿ã€‚</p>
<p>ä¸‹é¢æ˜¯ nginx.conf è¯¦ç»†çš„é…ç½®æ–‡ä»¶ä»‹ç»ï¼ˆä»¥ä¸‹é…ç½®å‚æ•°å¾ˆå¤šæ—¶å€™å¹¶ä¸ä¸€å®šç”¨çš„åˆ°ï¼Œåªæ˜¯ä½œä¸ºé…ç½®å‚æ•°è¯´æ˜å‚è€ƒï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„é€šç”¨ç‰ˆä»‹ç»ï¼‰</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><span class="line">#å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„</span><br><span class="line">user www www; </span><br><span class="line"></span><br><span class="line">#nginxè¿›ç¨‹æ•°ï¼Œé€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰</span><br><span class="line">worker_processes 4; </span><br><span class="line"></span><br><span class="line">#å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[debug | info | notice | warn | error | crit]</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#è¿›ç¨‹pidæ–‡ä»¶</span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#æŒ‡å®šè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æè¿°ç¬¦ï¼šæ•°ç›®</span><br><span class="line">#å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™</span><br><span class="line">##è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡å½“ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ulimit -n çš„å€¼ä¿æŒä¸€è‡´ã€‚</span><br><span class="line">#è¿™æ˜¯å› ä¸ºnginxè°ƒåº¦æ—¶åˆ†é…è¯·æ±‚åˆ°è¿›ç¨‹å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å‡è¡¡ï¼Œæ‰€ä»¥å‡å¦‚å¡«å†™10240ï¼Œæ€»å¹¶å‘é‡è¾¾åˆ°3-4ä¸‡æ—¶å°±æœ‰è¿›ç¨‹å¯èƒ½è¶…è¿‡10240äº†ï¼Œè¿™æ—¶ä¼šè¿”å›502é”™è¯¯ã€‚</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    #å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹</span><br><span class="line">    #æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œlinuxå»ºè®®epollï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚</span><br><span class="line">    #è¡¥å……è¯´æ˜ï¼š</span><br><span class="line">    #ä¸apacheç›¸ç±»ï¼Œnginxé’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸åŒçš„äº‹ä»¶æ¨¡å‹</span><br><span class="line">    #Aï¼‰æ ‡å‡†äº‹ä»¶æ¨¡å‹</span><br><span class="line">    #Selectã€pollå±äºæ ‡å‡†äº‹ä»¶æ¨¡å‹ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿä¸å­˜åœ¨æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œnginxä¼šé€‰æ‹©selectæˆ–poll</span><br><span class="line">    #Bï¼‰é«˜æ•ˆäº‹ä»¶æ¨¡å‹</span><br><span class="line">    #Kqueueï¼šä½¿ç”¨äºFreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 å’Œ MacOS X.ä½¿ç”¨åŒå¤„ç†å™¨çš„MacOS Xç³»ç»Ÿä½¿ç”¨kqueueå¯èƒ½ä¼šé€ æˆå†…æ ¸å´©æºƒã€‚</span><br><span class="line">    #Epollï¼šä½¿ç”¨äºLinuxå†…æ ¸2.6ç‰ˆæœ¬åŠä»¥åçš„ç³»ç»Ÿã€‚</span><br><span class="line">    #/dev/pollï¼šä½¿ç”¨äºSolaris 7 11/99+ï¼ŒHP/UX 11.22+ (eventport)ï¼ŒIRIX 6.5.15+ å’Œ Tru64 UNIX 5.1A+ã€‚</span><br><span class="line">    #Eventportï¼šä½¿ç”¨äºSolaris 10ã€‚ ä¸ºäº†é˜²æ­¢å‡ºç°å†…æ ¸å´©æºƒçš„é—®é¢˜ï¼Œ æœ‰å¿…è¦å®‰è£…å®‰å…¨è¡¥ä¸ã€‚</span><br><span class="line">    use epoll</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°+è¿›ç¨‹æ•°ï¼‰</span><br><span class="line">    #æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcupè·‘åˆ°100%å°±è¡Œã€‚</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">    </span><br><span class="line">    #keepalive è¶…æ—¶æ—¶é—´</span><br><span class="line">    keepalive_timeout 60;</span><br><span class="line">    </span><br><span class="line">    #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚å¤´çš„å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚</span><br><span class="line">    #åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZE å–å¾—ã€‚</span><br><span class="line">    #[root@web001 ~]# getconf PAGESIZE</span><br><span class="line">    #ä½†ä¹Ÿæœ‰client_header_buffer_sizeè¶…è¿‡4kçš„æƒ…å†µï¼Œä½†æ˜¯client_header_buffer_sizeè¯¥å€¼å¿…é¡»è®¾ç½®ä¸ºâ€œç³»ç»Ÿåˆ†é¡µå¤§å°â€çš„æ•´å€æ•°ã€‚</span><br><span class="line">    client_header_buffer_size 4k;</span><br><span class="line">    </span><br><span class="line">    #è¿™ä¸ªå°†ä¸ºæ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ï¼ŒmaxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactiveæ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚</span><br><span class="line">    open_file_cache max=65535 inactive=60s;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #è¿™ä¸ªæ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚</span><br><span class="line">    #è¯­æ³•:open_file_cache_valid time é»˜è®¤å€¼:open_file_cache_valid 60 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†ä½•æ—¶éœ€è¦æ£€æŸ¥open_file_cacheä¸­ç¼“å­˜é¡¹ç›®çš„æœ‰æ•ˆä¿¡æ¯.</span><br><span class="line">    open_file_cache_valid 80s;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #open_file_cacheæŒ‡ä»¤ä¸­çš„inactiveå‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸€ç›´æ˜¯åœ¨ç¼“å­˜ä¸­æ‰“å¼€çš„ï¼Œå¦‚ä¸Šä¾‹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶åœ¨inactiveæ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤ã€‚</span><br><span class="line">    #è¯­æ³•:open_file_cache_min_uses number é»˜è®¤å€¼:open_file_cache_min_uses 1 ä½¿ç”¨å­—æ®µ:http, server, location  è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†åœ¨open_file_cacheæŒ‡ä»¤æ— æ•ˆçš„å‚æ•°ä¸­ä¸€å®šçš„æ—¶é—´èŒƒå›´å†…å¯ä»¥ä½¿ç”¨çš„æœ€å°æ–‡ä»¶æ•°,å¦‚æœä½¿ç”¨æ›´å¤§çš„å€¼,æ–‡ä»¶æè¿°ç¬¦åœ¨cacheä¸­æ€»æ˜¯æ‰“å¼€çŠ¶æ€.</span><br><span class="line">    open_file_cache_min_uses 1;</span><br><span class="line">    </span><br><span class="line">    #è¯­æ³•:open_file_cache_errors on | off é»˜è®¤å€¼:open_file_cache_errors off ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šæ˜¯å¦åœ¨æœç´¢ä¸€ä¸ªæ–‡ä»¶æ˜¯è®°å½•cacheé”™è¯¯.</span><br><span class="line">    open_file_cache_errors on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒ</span><br><span class="line">http&#123;</span><br><span class="line">    #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨</span><br><span class="line">    include mime.types;</span><br><span class="line">    </span><br><span class="line">    #é»˜è®¤æ–‡ä»¶ç±»å‹</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    #é»˜è®¤ç¼–ç </span><br><span class="line">    charset utf-8;</span><br><span class="line">    </span><br><span class="line">    #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å°</span><br><span class="line">    #ä¿å­˜æœåŠ¡å™¨åå­—çš„hashè¡¨æ˜¯ç”±æŒ‡ä»¤server_names_hash_max_size å’Œserver_names_hash_bucket_sizeæ‰€æ§åˆ¶çš„ã€‚å‚æ•°hash bucket sizeæ€»æ˜¯ç­‰äºhashè¡¨çš„å¤§å°ï¼Œå¹¶ä¸”æ˜¯ä¸€è·¯å¤„ç†å™¨ç¼“å­˜å¤§å°çš„å€æ•°ã€‚åœ¨å‡å°‘äº†åœ¨å†…å­˜ä¸­çš„å­˜å–æ¬¡æ•°åï¼Œä½¿åœ¨å¤„ç†å™¨ä¸­åŠ é€ŸæŸ¥æ‰¾hashè¡¨é”®å€¼æˆä¸ºå¯èƒ½ã€‚å¦‚æœhash bucket sizeç­‰äºä¸€è·¯å¤„ç†å™¨ç¼“å­˜çš„å¤§å°ï¼Œé‚£ä¹ˆåœ¨æŸ¥æ‰¾é”®çš„æ—¶å€™ï¼Œæœ€åçš„æƒ…å†µä¸‹åœ¨å†…å­˜ä¸­æŸ¥æ‰¾çš„æ¬¡æ•°ä¸º2ã€‚ç¬¬ä¸€æ¬¡æ˜¯ç¡®å®šå­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨å­˜å‚¨å•å…ƒä¸­æŸ¥æ‰¾é”® å€¼ã€‚å› æ­¤ï¼Œå¦‚æœNginxç»™å‡ºéœ€è¦å¢å¤§hash max size æˆ– hash bucket sizeçš„æç¤ºï¼Œé‚£ä¹ˆé¦–è¦çš„æ˜¯å¢å¤§å‰ä¸€ä¸ªå‚æ•°çš„å¤§å°.</span><br><span class="line">    server_names_hash_bucket_size 128;</span><br><span class="line">    </span><br><span class="line">    #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZEå–å¾—ã€‚</span><br><span class="line">    client_header_buffer_size 32k;</span><br><span class="line">    </span><br><span class="line">    #å®¢æˆ·è¯·æ±‚å¤´ç¼“å†²å¤§å°ã€‚nginxé»˜è®¤ä¼šç”¨client_header_buffer_sizeè¿™ä¸ªbufferæ¥è¯»å–headerå€¼ï¼Œå¦‚æœheaderè¿‡å¤§ï¼Œå®ƒä¼šä½¿ç”¨large_client_header_buffersæ¥è¯»å–ã€‚</span><br><span class="line">    large_client_header_buffers 4 64k;</span><br><span class="line">    </span><br><span class="line">    #è®¾å®šé€šè¿‡nginxä¸Šä¼ æ–‡ä»¶çš„å¤§å°</span><br><span class="line">    client_max_body_size 8m;</span><br><span class="line">    </span><br><span class="line">    #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚</span><br><span class="line">    #sendfileæŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿuptimeã€‚</span><br><span class="line">    sendfile on;</span><br><span class="line">    </span><br><span class="line">     #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚</span><br><span class="line">    autoindex on;</span><br><span class="line">    </span><br><span class="line">      #æ­¤é€‰é¡¹å…è®¸æˆ–ç¦æ­¢ä½¿ç”¨sockeçš„TCP_CORKçš„é€‰é¡¹ï¼Œæ­¤é€‰é¡¹ä»…åœ¨ä½¿ç”¨sendfileçš„æ—¶å€™ä½¿ç”¨</span><br><span class="line">    tcp_nopush on;</span><br><span class="line">     </span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    </span><br><span class="line">    #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</span><br><span class="line">    keepalive_timeout 120;</span><br><span class="line">    </span><br><span class="line">    #FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚</span><br><span class="line">    fastcgi_connect_timeout 300;</span><br><span class="line">    fastcgi_send_timeout 300;</span><br><span class="line">    fastcgi_read_timeout 300;</span><br><span class="line">    fastcgi_buffer_size 64k;</span><br><span class="line">    fastcgi_buffers 4 64k;</span><br><span class="line">    fastcgi_busy_buffers_size 128k;</span><br><span class="line">    fastcgi_temp_file_write_size 128k;</span><br><span class="line">    </span><br><span class="line">    #gzipæ¨¡å—è®¾ç½®</span><br><span class="line">    gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡º</span><br><span class="line">    gzip_min_length 1k;    #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å°</span><br><span class="line">    gzip_buffers 4 16k;    #å‹ç¼©ç¼“å†²åŒº</span><br><span class="line">    gzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰</span><br><span class="line">    gzip_comp_level 2;     #å‹ç¼©ç­‰çº§</span><br><span class="line">    gzip_types text/plain application/x-javascript text/css application/xml;    #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«textmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚</span><br><span class="line">    gzip_vary on;</span><br><span class="line"></span><br><span class="line">    #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨</span><br><span class="line">    #limit_zone crawler $binary_remote_addr 10m;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #è´Ÿè½½å‡è¡¡é…ç½®</span><br><span class="line">    upstream piao.jd.com &#123;</span><br><span class="line">     </span><br><span class="line">        #upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚</span><br><span class="line">        server 192.168.80.121:80 weight=3;</span><br><span class="line">        server 192.168.80.122:80 weight=2;</span><br><span class="line">        server 192.168.80.123:80 weight=3;</span><br><span class="line"></span><br><span class="line">        #nginxçš„upstreamç›®å‰æ”¯æŒ4ç§æ–¹å¼çš„åˆ†é…</span><br><span class="line">        #1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">        #æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚</span><br><span class="line">        #2ã€weight</span><br><span class="line">        #æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚</span><br><span class="line">        #ä¾‹å¦‚ï¼š</span><br><span class="line">        #upstream bakend &#123;</span><br><span class="line">        #    server 192.168.0.14 weight=10;</span><br><span class="line">        #    server 192.168.0.15 weight=10;</span><br><span class="line">        #&#125;</span><br><span class="line">        #2ã€ip_hash</span><br><span class="line">        #æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚</span><br><span class="line">        #ä¾‹å¦‚ï¼š</span><br><span class="line">        #upstream bakend &#123;</span><br><span class="line">        #    ip_hash;</span><br><span class="line">        #    server 192.168.0.14:88;</span><br><span class="line">        #    server 192.168.0.15:80;</span><br><span class="line">        #&#125;</span><br><span class="line">        #3ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</span><br><span class="line">        #æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</span><br><span class="line">        #upstream backend &#123;</span><br><span class="line">        #    server server1;</span><br><span class="line">        #    server server2;</span><br><span class="line">        #    fair;</span><br><span class="line">        #&#125;</span><br><span class="line">        #4ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</span><br><span class="line">        #æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚</span><br><span class="line">        #ä¾‹ï¼šåœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•</span><br><span class="line">        #upstream backend &#123;</span><br><span class="line">        #    server squid1:3128;</span><br><span class="line">        #    server squid2:3128;</span><br><span class="line">        #    hash $request_uri;</span><br><span class="line">        #    hash_method crc32;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        #tips:</span><br><span class="line">        #upstream bakend&#123;#å®šä¹‰è´Ÿè½½å‡è¡¡è®¾å¤‡çš„IpåŠè®¾å¤‡çŠ¶æ€&#125;&#123;</span><br><span class="line">        #    ip_hash;</span><br><span class="line">        #    server 127.0.0.1:9090 down;</span><br><span class="line">        #    server 127.0.0.1:8080 weight=2;</span><br><span class="line">        #    server 127.0.0.1:6060;</span><br><span class="line">        #    server 127.0.0.1:7070 backup;</span><br><span class="line">        #&#125;</span><br><span class="line">        #åœ¨éœ€è¦ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„serverä¸­å¢åŠ  proxy_pass http://bakend/;</span><br><span class="line"></span><br><span class="line">        #æ¯ä¸ªè®¾å¤‡çš„çŠ¶æ€è®¾ç½®ä¸º:</span><br><span class="line">        #1.downè¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½</span><br><span class="line">        #2.weightä¸ºweightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚</span><br><span class="line">        #3.max_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstreamæ¨¡å—å®šä¹‰çš„é”™è¯¯</span><br><span class="line">        #4.fail_timeout:max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚</span><br><span class="line">        #5.backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚æ‰€ä»¥è¿™å°æœºå™¨å‹åŠ›ä¼šæœ€è½»ã€‚</span><br><span class="line"></span><br><span class="line">        #nginxæ”¯æŒåŒæ—¶è®¾ç½®å¤šç»„çš„è´Ÿè½½å‡è¡¡ï¼Œç”¨æ¥ç»™ä¸ç”¨çš„serveræ¥ä½¿ç”¨ã€‚</span><br><span class="line">        #client_body_in_file_onlyè®¾ç½®ä¸ºOn å¯ä»¥è®²client postè¿‡æ¥çš„æ•°æ®è®°å½•åˆ°æ–‡ä»¶ä¸­ç”¨æ¥åšdebug</span><br><span class="line">        #client_body_temp_pathè®¾ç½®è®°å½•æ–‡ä»¶çš„ç›®å½• å¯ä»¥è®¾ç½®æœ€å¤š3å±‚ç›®å½•</span><br><span class="line">        #locationå¯¹URLè¿›è¡ŒåŒ¹é….å¯ä»¥è¿›è¡Œé‡å®šå‘æˆ–è€…è¿›è¡Œæ–°çš„ä»£ç† è´Ÿè½½å‡è¡¡</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #è™šæ‹Ÿä¸»æœºçš„é…ç½®</span><br><span class="line">    server &#123;</span><br><span class="line">        #ç›‘å¬ç«¯å£</span><br><span class="line">        listen 80;</span><br><span class="line"></span><br><span class="line">        #åŸŸåå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€</span><br><span class="line">        server_name www.jd.com jd.com;</span><br><span class="line">        #é»˜è®¤å…¥å£æ–‡ä»¶åç§°</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        root /data/www/jd;</span><br><span class="line"></span><br><span class="line">        #å¯¹******è¿›è¡Œè´Ÿè½½å‡è¡¡</span><br><span class="line">        location ~ .*.(php|php5)?$</span><br><span class="line">        &#123;</span><br><span class="line">            fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">            fastcgi_index index.php;</span><br><span class="line">            include fastcgi.conf;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        #å›¾ç‰‡ç¼“å­˜æ—¶é—´è®¾ç½®</span><br><span class="line">        location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 10d;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        #JSå’ŒCSSç¼“å­˜æ—¶é—´è®¾ç½®</span><br><span class="line">        location ~ .*.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 1h;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        #æ—¥å¿—æ ¼å¼è®¾å®š</span><br><span class="line">        #$remote_addrä¸$http_x_forwarded_forç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›</span><br><span class="line">        #$remote_userï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›</span><br><span class="line">        #$time_localï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›</span><br><span class="line">        #$requestï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼›</span><br><span class="line">        #$statusï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼Œ</span><br><span class="line">        #$body_bytes_sent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›</span><br><span class="line">        #$http_refererï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼›</span><br><span class="line">        #$http_user_agentï¼šè®°å½•å®¢æˆ·æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›</span><br><span class="line">        #é€šå¸¸webæœåŠ¡å™¨æ”¾åœ¨åå‘ä»£ç†çš„åé¢ï¼Œè¿™æ ·å°±ä¸èƒ½è·å–åˆ°å®¢æˆ·çš„IPåœ°å€äº†ï¼Œé€šè¿‡$remote_addæ‹¿åˆ°çš„IPåœ°å€æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„iPåœ°å€ã€‚åå‘ä»£ç†æœåŠ¡å™¨åœ¨è½¬å‘è¯·æ±‚çš„httpå¤´ä¿¡æ¯ä¸­ï¼Œå¯ä»¥å¢åŠ x_forwarded_forä¿¡æ¯ï¼Œç”¨ä»¥è®°å½•åŸæœ‰å®¢æˆ·ç«¯çš„IPåœ°å€å’ŒåŸæ¥å®¢æˆ·ç«¯çš„è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€ã€‚</span><br><span class="line">        log_format access &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">        &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">        &#x27;&quot;$http_user_agent&quot; $http_x_forwarded_for&#x27;;</span><br><span class="line">         </span><br><span class="line">        #å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—</span><br><span class="line">        access_log  /usr/local/nginx/logs/host.access.log  main;</span><br><span class="line">        access_log  /usr/local/nginx/logs/host.access.404.log  log404;</span><br><span class="line">         </span><br><span class="line">        #å¯¹ &quot;/connect-controller&quot; å¯ç”¨åå‘ä»£ç†</span><br><span class="line">        location /connect-controller &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:88; #è¯·æ³¨æ„æ­¤å¤„ç«¯å£å·ä¸èƒ½ä¸è™šæ‹Ÿä¸»æœºç›‘å¬çš„ç«¯å£å·ä¸€æ ·ï¼ˆä¹Ÿå°±æ˜¯serverç›‘å¬çš„ç«¯å£ï¼‰</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">             </span><br><span class="line">            #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">             </span><br><span class="line">            #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line"></span><br><span class="line">            #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">            client_max_body_size 10m;</span><br><span class="line"></span><br><span class="line">            #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ</span><br><span class="line">            #å¦‚æœæŠŠå®ƒè®¾ç½®ä¸ºæ¯”è¾ƒå¤§çš„æ•°å€¼ï¼Œä¾‹å¦‚256kï¼Œé‚£ä¹ˆï¼Œæ— è®ºä½¿ç”¨firefoxè¿˜æ˜¯IEæµè§ˆå™¨ï¼Œæ¥æäº¤ä»»æ„å°äº256kçš„å›¾ç‰‡ï¼Œéƒ½å¾ˆæ­£å¸¸ã€‚å¦‚æœæ³¨é‡Šè¯¥æŒ‡ä»¤ï¼Œä½¿ç”¨é»˜è®¤çš„client_body_buffer_sizeè®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿé¡µé¢å¤§å°çš„ä¸¤å€ï¼Œ8kæˆ–è€…16kï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚</span><br><span class="line">            #æ— è®ºä½¿ç”¨firefox4.0è¿˜æ˜¯IE8.0ï¼Œæäº¤ä¸€ä¸ªæ¯”è¾ƒå¤§ï¼Œ200kå·¦å³çš„å›¾ç‰‡ï¼Œéƒ½è¿”å›500 Internal Server Erroré”™è¯¯</span><br><span class="line">            client_body_buffer_size 128k;</span><br><span class="line"></span><br><span class="line">            #è¡¨ç¤ºä½¿nginxé˜»æ­¢HTTPåº”ç­”ä»£ç ä¸º400æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚</span><br><span class="line">            proxy_intercept_errors on;</span><br><span class="line"></span><br><span class="line">            #åç«¯æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é—´_å‘èµ·æ¡æ‰‹ç­‰å€™å“åº”è¶…æ—¶æ—¶é—´</span><br><span class="line">            #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span><br><span class="line">            proxy_connect_timeout 90;</span><br><span class="line"></span><br><span class="line">            #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span><br><span class="line">            #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´_å°±æ˜¯åœ¨è§„å®šæ—¶é—´ä¹‹å†…åç«¯æœåŠ¡å™¨å¿…é¡»ä¼ å®Œæ‰€æœ‰çš„æ•°æ®</span><br><span class="line">            proxy_send_timeout 90;</span><br><span class="line"></span><br><span class="line">            #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span><br><span class="line">            #è¿æ¥æˆåŠŸå_ç­‰å€™åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´_å…¶å®å·²ç»è¿›å…¥åç«¯çš„æ’é˜Ÿä¹‹ä¸­ç­‰å€™å¤„ç†ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ—¶é—´ï¼‰</span><br><span class="line">            proxy_read_timeout 90;</span><br><span class="line"></span><br><span class="line">            #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span><br><span class="line">            #è®¾ç½®ä»è¢«ä»£ç†æœåŠ¡å™¨è¯»å–çš„ç¬¬ä¸€éƒ¨åˆ†åº”ç­”çš„ç¼“å†²åŒºå¤§å°ï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™éƒ¨åˆ†åº”ç­”ä¸­åŒ…å«ä¸€ä¸ªå°çš„åº”ç­”å¤´ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼çš„å¤§å°ä¸ºæŒ‡ä»¤proxy_buffersä¸­æŒ‡å®šçš„ä¸€ä¸ªç¼“å†²åŒºçš„å¤§å°ï¼Œä¸è¿‡å¯ä»¥å°†å…¶è®¾ç½®ä¸ºæ›´å°</span><br><span class="line">            proxy_buffer_size 4k;</span><br><span class="line"></span><br><span class="line">            #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½®</span><br><span class="line">            #è®¾ç½®ç”¨äºè¯»å–åº”ç­”ï¼ˆæ¥è‡ªè¢«ä»£ç†æœåŠ¡å™¨ï¼‰çš„ç¼“å†²åŒºæ•°ç›®å’Œå¤§å°ï¼Œé»˜è®¤æƒ…å†µä¹Ÿä¸ºåˆ†é¡µå¤§å°ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒå¯èƒ½æ˜¯4kæˆ–è€…8k</span><br><span class="line">            proxy_buffers 4 32k;</span><br><span class="line"></span><br><span class="line">            #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span><br><span class="line">            proxy_busy_buffers_size 64k;</span><br><span class="line"></span><br><span class="line">            #è®¾ç½®åœ¨å†™å…¥proxy_temp_pathæ—¶æ•°æ®çš„å¤§å°ï¼Œé¢„é˜²ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åœ¨ä¼ é€’æ–‡ä»¶æ—¶é˜»å¡å¤ªé•¿</span><br><span class="line">            #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span><br><span class="line">            proxy_temp_file_write_size 64k;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        #æœ¬åœ°åŠ¨é™åˆ†ç¦»åå‘ä»£ç†é…ç½®</span><br><span class="line">        #æ‰€æœ‰jspçš„é¡µé¢å‡äº¤ç”±tomcatæˆ–resinå¤„ç†</span><br><span class="line">        location ~ .(jsp|jspx|do)?$ &#123;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://127.0.0.1:8080;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>é€šç”¨ï¼ˆè¿™é‡Œæ˜¯ windows ç³»ç»Ÿç³» nginx1.14.2 ä¸‹ nginx.conf é…ç½®ï¼‰</p>
<p>ä¸‹é¢çš„nginx.confç®€å•çš„å®ç°nginxåœ¨å‰ç«¯åšåå‘ä»£ç†æœåŠ¡å™¨çš„ä¾‹å­ï¼Œå¤„ç†jsã€pngç­‰é™æ€æ–‡ä»¶ï¼Œjspç­‰åŠ¨æ€è¯·æ±‚è½¬å‘åˆ°å…¶å®ƒæœåŠ¡å™¨ï¼ˆç›¸å…³é…ç½®å‚æ•°è¯¦è§£å‚ç…§ä¸Šé¢çš„è§£é‡Šï¼‰ï¼š æ¶‰åŠåˆ°</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line">    error_log   logs/ssl.error.log crit;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8088;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        charset utf-8;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        #å…¥å£æ–‡ä»¶çš„è®¾ç½®</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   D:/vueWork/dentalFactory/dist; #å…¥å£æ–‡ä»¶çš„æ‰€åœ¨ç›®å½•</span><br><span class="line">            index  index.html index.htm; #é»˜è®¤å…¥å£æ–‡ä»¶åç§°</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        # tomcat åå‘ä»£ç†é…ç½®</span><br><span class="line">        location /locationåç§°/ &#123;</span><br><span class="line">            proxy_pass http://192.168.1.10:8080; # http://127.0.0.1:8080/æœåŠ¡åï¼ˆé¡¹ç›®åç§°ï¼‰/</span><br><span class="line">            #proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header Host $host:$server_port;//æ³¨æ„ï¼šå½“å‰ç«¯é¡¹ç›®ç«¯å£å·ä¸æ˜¯8080 éœ€è¦è¿™æ ·é…ç½®ï¼Œå¦åˆ™åç«¯æ‹¿ä¸åˆ°æ­£ç¡®ç«¯å£å·</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        #é™æ€èµ„æºçš„ä»£ç†é…ç½®ï¼ˆä¸€èˆ¬ä¸ç”¨é…ç½®ï¼Œè¿™é‡Œä¸¾ä¾‹é…ç½®å›¾ç‰‡èµ„æºçš„é…ç½®æƒ…å†µï¼‰</span><br><span class="line">        #location /images/ &#123;</span><br><span class="line">        #    root   D:/A-studySpace/nginxDemo;</span><br><span class="line">        #&#125;</span><br><span class="line">        </span><br><span class="line">        #è¿™é‡Œæ˜¯é…ç½®404é¡µé¢çš„åœ°æ–¹</span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        #ç›¸åº”çš„è¿™æ˜¯å¯¹åº”è¯·æ±‚çŠ¶æ€çš„é¡µé¢é…ç½®åœ°æ–¹</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # php åå‘ä»£ç†é…ç½®</span><br><span class="line">        #å°†æ‰€æœ‰phpé¡µé¢çš„è¯·æ±‚è½¬ç»™php-fpmå¤„ç†</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name; #fastcgi_paramé…ç½®å‚æ•°è¾ƒå¤šï¼Œé…Œæƒ…æŒ‰éœ€è°ƒæ•´</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


<p>å‚è€ƒæ–‡ç« </p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://juejin.im/post/6844903741678698510" >nginx.conf é…ç½®æ–‡ä»¶è¯¦è§£</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ æœ¬æ–‡ç»“æŸï¼Œæ„Ÿè°¢æ‚¨çš„é˜…è¯» ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">æœ¬æ–‡ä½œè€…: </span><span class="copyright-author__value"><a href="https://msy.plus">å¢¨æŠ’é¢–</a></span></div><div class="copyright-link"><span class="copyright-link__name">æœ¬æ–‡é“¾æ¥: </span><span class="copyright-link__value"><a href="https://msy.plus/2019/02/07/nginx-cros/">https://msy.plus/2019/02/07/nginx-cros/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">ç‰ˆæƒå£°æ˜: </span><span class="copyright-notice__value">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://msy.plus/tags/%E8%BF%90%E7%BB%B4/">è¿ç»´</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://msy.plus/tags/nginx/">nginx</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://msy.plus/tags/cros/">cros</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://msy.plus/tags/%E5%AE%9D%E5%A1%94/">å®å¡”</a></span></div><div class="post-share"><div class="social-share" data-sites="qzone, qq, weibo, wechat, douban, linkedin, facebook, twitter, google">Share to: </div></div><div class="post-reward reward"><div class="reward-button">è¯·æˆ‘å–æ¯å’–å•¡~</div><div class="reward-qrcode"><span class="reward-qrcode-alipay"><img class="reward-qrcode-alipay__img" src="/uploads/alipay.jpg"><div class="reward-qrcode-alipay__text">æ”¯ä»˜å®æ‰“èµ</div></span><span class="reward-qrcode-wechat"><img class="reward-qrcode-wechat__img" src="/uploads/wechat.png"><div class="reward-qrcode-wechat__text">å¾®ä¿¡æ‰“èµ</div></span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2019/03/18/js-default-rounding/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">javascript è§£å†³é»˜è®¤å–æ•´çš„å‘(ç›®å‰å·²çŸ¥çš„æœ€ä½³è§£å†³æ–¹æ¡ˆ)</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2018/11/23/docker-operations/"><span class="paginator-prev__text">dockerå¸¸ç”¨æ“ä½œ</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="disqus_thread"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">æ–‡ç« ç›®å½•</span><span class="sidebar-nav-ov">ç«™ç‚¹æ¦‚è§ˆ</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%9D%E5%A1%94%E9%85%8D%E7%BD%AEnginx%E7%9A%84cros"><span class="toc-number">1.</span> <span class="toc-text">
          è®°ä¸€æ¬¡å®å¡”é…ç½®nginxçš„cros</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2020%E5%B9%B412%E6%9C%8812%E6%97%A511-59-56-%E6%9B%B4%E6%96%B0"><span class="toc-number">1.1.</span> <span class="toc-text">
          2020å¹´12æœˆ12æ—¥11:59:56 æ›´æ–°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2020%E5%B9%B410%E6%9C%8809%E6%97%A511-34-%E6%9B%B4%E6%96%B0"><span class="toc-number">1.2.</span> <span class="toc-text">
          2020å¹´10æœˆ09æ—¥11:34    æ›´æ–°</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">
          æ‰©å±•çŸ¥è¯†</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/uploads/pic-512x512.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">ä½ å¯ä»¥åœ¨è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/moshuying/" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="http://sfau.lt/bPbzVVJ/" target="_blank" rel="noopener" data-popover="æ€å¦" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">sf</span></a><a class="sidebar-ov-social-item" href="https://home.cnblogs.com/u/moshuying/" target="_blank" rel="noopener" data-popover="social.bokeyuan" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">åšå®¢å›­</span></a><a class="sidebar-ov-social-item" href="https://juejin.im/user/2700056289356936/" target="_blank" rel="noopener" data-popover="social.juejin" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">æ˜é‡‘</span></a><a class="sidebar-ov-social-item" href="http://weibo.cn/ismoshuying" target="_blank" rel="noopener" data-popover="å¾®åš" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-weibo"></i></span></a><a class="sidebar-ov-social-item" href="https://www.zhihu.com/people/mo-shu-ying-54" target="_blank" rel="noopener" data-popover="çŸ¥ä¹" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">çŸ¥</span></a><a class="sidebar-ov-social-item" href="https://blog.csdn.net/qq_34846662" target="_blank" rel="noopener" data-popover="social.csdn" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">csdn</span></a></div><div class="sidebar-ov-feed"><span class="sidebar-ov-feed-email"><a class="sidebar-ov-feed-email__link" href="http://eepurl.com/heNNvH" target="_blank" rel="noopener"><span class="sidebar-ov-feed-email__icon"><i class="fas fa-envelope"></i></span><span>Email è®¢é˜…</span></a></span><span class="sidebar-ov-feed-rss"><a class="sidebar-ov-feed-rss__link" href="/atom.xml" target="_blank" rel="noopener"><span class="sidebar-ov-feed-rss__icon"><i class="fas fa-rss"></i></span><span>RSS è®¢é˜…</span></a></span></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">30</div><div class="sidebar-ov-state-item__name">å½’æ¡£</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">14</div><div class="sidebar-ov-state-item__name">åˆ†ç±»</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">30</div><div class="sidebar-ov-state-item__name">æ ‡ç­¾</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="çŸ¥è¯†å…±äº«è®¸å¯åè®®" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">ä½ å·²é˜…è¯»äº† </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright Â© 2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>å¢¨æŠ’é¢–</span><span class="footer__devider">|</span><span><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn" >èœ€ICPå¤‡19031274å·-1</a></span></div><div><span>ç”± <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> å¼ºåŠ›é©±åŠ¨</span><span> v5.4.0</span><span class="footer__devider">|</span><span>ä¸»é¢˜ - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">è®¿é—®äººæ•°</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">æµè§ˆæ€»é‡</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="æœç´¢æ–‡ç« ï¼ˆæ”¯æŒå¤šå…³é”®è¯ï¼Œè¯·ç”¨ç©ºæ ¼åˆ†éš”ï¼‰"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/ribbon.js@latest/dist/ribbon.min.js" size="300" alpha="0.6" zIndex="-1"></script><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // å°† XML è½¬ä¸º JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // æœç´¢å¯¹è±¡ï¼ˆæ ‡é¢˜ã€å†…å®¹ï¼‰çš„æƒé‡ï¼Œå½±å“æ˜¾ç¤ºé¡ºåº
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // æ ¹æ®ç©ºç™½å­—ç¬¦åˆ†éš”å…³é”®å­—
        var keywords = searchText.split(/[\s]+/);
        // æœç´¢ç»“æœ
        var matchPosts = [];

        // æœ‰å¤šä¸ªå…³é”®å­—æ—¶ï¼Œå°†åŸæ–‡å­—æ•´ä¸ªä¿å­˜ä¸‹æ¥
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // é˜²æ­¢æœªè¾“å…¥å­—ç¬¦æ—¶æœç´¢
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // æ²¡æœ‰æ ‡é¢˜çš„æ–‡ç« ä½¿ç”¨é¢„è®¾çš„ i18n å˜é‡ä»£æ›¿
            var title = (data.title && data.title.trim()) || '[ æ–‡ç« æ— æ ‡é¢˜ ]';
            var titleLower = title && title.toLowerCase();
            // åˆ é™¤ HTML æ ‡ç­¾ å’Œ æ‰€æœ‰ç©ºç™½å­—ç¬¦
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // åˆ é™¤é‡å¤çš„ /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // æ ‡é¢˜ä¸­åŒ¹é…åˆ°çš„å…³é”®è¯
            var titleHitSlice = [];
            // å†…å®¹ä¸­åŒ¹é…åˆ°çš„å…³é”®è¯
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * è·å–åŒ¹é…çš„å…³é”®è¯çš„ç´¢å¼•
              * @param {String} keyword è¦åŒ¹é…çš„å…³é”®å­—
              * @param {String} text åŸæ–‡å­—
              * @param {Boolean} caseSensitive æ˜¯å¦åŒºåˆ†å¤§å°å†™
              * @param {Number} weight åŒ¹é…å¯¹è±¡çš„æƒé‡ã€‚æƒé‡å¤§çš„ä¼˜å…ˆæ˜¾ç¤º
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // æ¯æ¬¡åŒ¹é…çš„å¼€å§‹ç´¢å¼•
                var index = -1;     // åŒ¹é…åˆ°çš„ç´¢å¼•å€¼
                var result = [];    // åŒ¹é…ç»“æœ

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // ç´¢å¼•ä½ç½®ç›¸åŒçš„å…³é”®è¯ï¼Œä¿ç•™é•¿åº¦è¾ƒé•¿çš„
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // æŒ‰ç…§åŒ¹é…æ–‡å­—çš„ç´¢å¼•çš„é€’å¢é¡ºåºæ’åº
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * ç»™æ–‡æœ¬ä¸­åŒ¹é…åˆ°çš„å…³é”®è¯æ·»åŠ æ ‡è®°ï¼Œä»è€Œè¿›è¡Œé«˜äº®æ˜¾ç¤º
              * @param {String} text åŸæ–‡æœ¬
              * @param {Array} hitSlice åŒ¹é…é¡¹çš„ç´¢å¼•ä¿¡æ¯
              * @param {Number} start å¼€å§‹ç´¢å¼•
              * @param {Number} end ç»“æŸç´¢å¼•
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // æ–‡ç« æ€»çš„æœç´¢æƒé‡
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // æ ‡è®°åŒ¹é…å…³é”®è¯åçš„æ ‡é¢˜
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // æ ‡è®°åŒ¹é…å…³é”®è¯åçš„å†…å®¹
              var postContent;
              // æ˜¾ç¤ºå†…å®¹çš„é•¿åº¦
              var SHOW_WORD_LENGTH = 200;
              // å‘½ä¸­å…³é”®è¯å‰çš„å­—ç¬¦æ˜¾ç¤ºé•¿åº¦
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // æˆªå–åŒ¹é…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œå‰åå…± 200 ä¸ªå­—ç¬¦æ¥æ˜¾ç¤º
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // æœªåŒ¹é…åˆ°å†…å®¹ï¼Œç›´æ¥æˆªå–å‰ 200 ä¸ªå­—ç¬¦æ¥æ˜¾ç¤º
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // æŒ‰æƒé‡é€’å¢çš„é¡ºåºæ’åºï¼Œä½¿æƒé‡å¤§çš„ä¼˜å…ˆæ˜¾ç¤º
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', 'è¯·è¾“å…¥å­—ç¬¦');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', function () {
  var pjax = new Pjax({"selectors":["head title","#main",".pjax-reload"],"history":true,"scrollTo":false,"scrollRestoration":false,"cacheBust":false,"debug":false,"currentUrlFullReload":false,"timeout":0});
  // åŠ è½½è¿›åº¦æ¡çš„è®¡æ—¶å™¨
  var loadingTimer = null;

  // é‡ç½®é¡µé¢ Y æ–¹å‘ä¸Šçš„æ»šåŠ¨åç§»é‡
  document.addEventListener('pjax:send', function () {
    $('.header-nav-menu').removeClass('show');
    if (CONFIG.pjax && CONFIG.pjax.avoidBanner) {
      $('html').velocity('scroll', {
        duration: 500,
        offset: $('#header').height(),
        easing: 'easeInOutCubic'
      });
    }

    var loadingBarWidth = 20;
    var MAX_LOADING_WIDTH = 95;

    $('.loading-bar').addClass('loading');
    $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    clearInterval(loadingTimer);
    loadingTimer = setInterval(function () {
      loadingBarWidth += 3;
      if (loadingBarWidth > MAX_LOADING_WIDTH) {
        loadingBarWidth = MAX_LOADING_WIDTH;
      }
      $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    }, 500);
  }, false);

  window.addEventListener('pjax:complete', function () {
    clearInterval(loadingTimer);
    $('.loading-bar__progress').css('width', '100%');
    $('.loading-bar').removeClass('loading');
    setTimeout(function () {
      $('.loading-bar__progress').css('width', '0');
    }, 400);
    $('link[rel=prefetch], script[data-pjax-rm]').each(function () {
      $(this).remove();
    });
    $('script[data-pjax], #pjax-reload script').each(function () {
      $(this).parent().append($(this).remove());
    });

    if (Stun.utils.pjaxReloadBoot) {
      Stun.utils.pjaxReloadBoot();
    }
    if (Stun.utils.pjaxReloadScroll) {
      Stun.utils.pjaxReloadScroll();
    }
    if (Stun.utils.pjaxReloadSidebar) {
      Stun.utils.pjaxReloadSidebar();
    }
    if (false) {
      if (Stun.utils.pjaxReloadHeader) {
        Stun.utils.pjaxReloadHeader();
      }
      if (Stun.utils.pjaxReloadScrollIcon) {
        Stun.utils.pjaxReloadScrollIcon();
      }
      if (Stun.utils.pjaxReloadLocalSearch) {
        Stun.utils.pjaxReloadLocalSearch();
      }
    }
  }, false);
}, false);</script><div id="pjax-reload"><script src="https://cdn.jsdelivr.net/npm/quicklink@1.0.1/dist/quicklink.umd.js"></script><script>function initQuicklink() {
  quicklink({
    timeout: '10000',
    priority: true,
    ignores: [uri => uri.includes('#'), uri => uri === 'https://msy.plus/2019/02/07/nginx-cros/', /\/api\/?/,uri => uri.includes('.xml'),uri => uri.includes('.zip'),(uri, el) => el.hasAttribute('nofollow'),(uri, el) => el.hasAttribute('noprefetch')]
  });
}

if (true || false) {
  initQuicklink();
} else {
  window.addEventListener('DOMContentLoaded', initQuicklink, false);
}</script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script></div><script data-pjax="">function loadDisqus () {
  if (!document.getElementById('disqus_thread')) {
    return;
  }
  if (window.DISQUS) {
    DISQUS.reset({
      reload: true,
      config: function () {
        this.page.url = 'https://msy.plus/2019/02/07/nginx-cros/';
        this.page.identifier = '2019/02/07/nginx-cros/';
        this.page.title = 'å®å¡” nginx cros';
      }
    });
  } else {
    var d = document;
    var sc = d.createElement('script');
    var se = d.createElement('script');

    if (true) {
      sc.src = 'https://msy-plus.disqus.com/count.js';
      sc.id = 'dsq-count-scr';
      sc.async = true;
      if (true) {
        sc.setAttribute('data-pjax', '');
      }
      (d.head || d.body).appendChild(sc);
    }
    se.src = 'https://msy-plus.disqus.com/embed.js';
    (d.head || d.body).appendChild(se);
  }
}

if (true) {
  loadDisqus();
} else {
  window.addEventListener('DOMContentLoaded', loadDisqus, false);
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script></body></html>